---
title: "Power and Personality Processing Script"
author: "Dominic DiCarlo"
date: "July 29, 2019"
output: html_document
---

Summer 2019 Power and Personality Pilot Study. Maestripieri Lab.

Script started by Dominic DiCarlo - August 2019

The data has been processed in chunks. Each assessment gets its own chunk. For detailed variable breakdown to understand what the data for each assessment means, see the [variable guide](./variable_guide.md).

To actually process the data, all you have to do is add the data in csv form to the same directory as this .Rmd file. Then, change the names of the csv_path variables in the {r csv import} chunk.

Make sure you have the four required libraries installed, listed below in the {r library import} chunk.

TO DO:
Process the working memory data.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r library import}

#Import libraries
library(readr)
library(dplyr)
library(tidyr)
library(tidyverse)

```

```{r csv import}

# path to csv data. these are the variables to change when
# changing the name of the data
csv_path_surveys <- "./p&p_dummy_data.csv"

csv_path_pre_tsst <- "./pre_tsst_emotions_and_stai.csv"

csv_path_post_tsst <- "./post_tsst_emotions_and_stai.csv"

# read in the qualtrics csv. change the csv_path variable
# to the file path to the data
surveys_data <- read_csv(csv_path_surveys)

pre_tsst_data <- read_csv(csv_path_pre_tsst)

post_tsst_data <- read_csv(csv_path_post_tsst)


# let's remove a bunch of junk book keeping columns qualtrics 
# keeps track of
surveys_sel_cols <- surveys_data %>%
  select(-"StartDate", -"EndDate", -"Status", -"IPAddress", -"Progress",
         -"Duration (in seconds)", -"Finished", -"RecordedDate", 
         -"ResponseId", -"RecipientLastName", -"RecipientFirstName",
         -"RecipientEmail", -"ExternalReference", -"LocationLatitude",
         -"LocationLongitude", -"DistributionChannel", -"UserLanguage",
         -"consent", -"email")

pre_tsst_cols <- pre_tsst_data %>%
  select(-"StartDate", -"EndDate", -"Status", -"IPAddress", -"Progress",
         -"Duration (in seconds)", -"Finished", -"RecordedDate", 
         -"ResponseId", -"RecipientLastName", -"RecipientFirstName",
         -"RecipientEmail", -"ExternalReference", -"LocationLatitude",
         -"LocationLongitude", -"DistributionChannel", -"UserLanguage",
         -"sbj_id")

post_tsst_cols <- post_tsst_data %>%
  select(-"StartDate", -"EndDate", -"Status", -"IPAddress", -"Progress",
         -"Duration (in seconds)", -"Finished", -"RecordedDate", 
         -"ResponseId", -"RecipientLastName", -"RecipientFirstName",
         -"RecipientEmail", -"ExternalReference", -"LocationLatitude",
         -"LocationLongitude", -"DistributionChannel", -"UserLanguage",
         -"sbj_id")


# also have to delete some extra rows from qualtrics data
surveys_sel_cols <- surveys_sel_cols[-c(1, 2), ]

pre_tsst_cols <- pre_tsst_cols[-c(1, 2), ]

post_tsst_cols <- post_tsst_cols[-c(1, 2), ]


# turn char into numbers
surveys_sel_cols <- surveys_sel_cols %>%
  mutate_at(c(1:117), as.numeric) %>%
  # mac ss exception (what is this?) from 118-127
  mutate_at(c(128:138), as.numeric) %>%
  # another exception at 139. "other" for standardized test score
  # some people will fill in didn't take, or put in some strange test
  mutate_at(c(140:386), as.numeric)
  # last columns (387-399) are more confusing data. stuff like major,
  # occupation. I have left these for now. 

pre_tsst_cols <- pre_tsst_cols %>%
  # all cols can be mutated
  mutate_at(c(1:38), as.numeric) 
  
post_tsst_cols <- post_tsst_cols %>%
  # all cols can be mutated
  mutate_at(c(1:38), as.numeric) 


```

```{r tsst}

# add up the STAI subscores as well as "SB" (whatever that is)
pre_tsst_cols <- pre_tsst_cols %>%
  mutate(STAI_Score <- rowSums(select(., contains("Anx"))),
         SB_Score <- rowSums(select(., contains("pre_sb"))))

post_tsst_cols <- post_tsst_cols %>%
  mutate(STAI_Score <- rowSums(select(., contains("Anx"))),
         SB_Score <- rowSums(select(., contains("pre_sb"))))

```

```{r MSOI}

# Sexual Orientation and Preferences
data_msoi <- surveys_sel_cols %>%
  select(`MSOI_1`, `MSOI_2.1`, MSOI2.2, `MSOI2.3`, `MSOI2.4`, `MSOI3.1`,
         `MSOI3.2`, `MSOI3.3`, `MSOI3.4`, `MSOI4.1`, `MSOI4.2`, `MSOI4.3`, `MSOI5`,
         `MSOI6`, `MSOI7`, `MSOI8.1`, `MSOI8.2`, `MSOI8.3`, `MSOI8.4`, `MSOI8.5`,
         `MSOI8.6`, `MSOI8.7`, `MSOI8.8`, `MSOI8.9`, `MSOI8.10`, `MSOI8.11`,
         `MSOI8.12`, `MSOI8.13`, `MSOI8.14`, `MSOI8.15`, `MSOI8.16`, `MSOI8.17`,
         `MSOI8.18`, `MSOI8.19`, `MSOI8.20`)  %>%
  rename("Sex_Orientation" = MSOI_1,
         "Intercourse_Partners_All" = MSOI_2.1,
         "Intercourse_Partners_Short_Term" = MSOI2.2,
         "Intercourse_Partners_Committed_Partner" = MSOI2.3,
         "Intercourse_Partners_Committed_Self" = MSOI2.4,
         "Intercourse_Partners_All_Past_Year" = MSOI3.1,
         "Intercourse_Partners_Short_Term_Past_Year" = MSOI3.2,
         "Intercourse_Partners_Committed_Partner_Past_Year" = MSOI3.3,
         "Intercourse_Partners_Committed_Self_Past_Year" = MSOI3.4,
         "Intercourse_Partners_All_Next_Five_Years" = MSOI4.1,
         "Intercourse_Partners_Committed_Next_Five_Years" = MSOI4.2,
         "Intercourse_Partners_Short_Term_Next_Five_Years" = MSOI4.3,
         "Intercourse_Partners_One_Time_Only" = MSOI5,
         "Sex_Partners_Other_than_Partner_In_Committed_Relationship" = MSOI6,
         "Fantasy_Rate_While_in_Committed_Relationship" = MSOI7,
         "SMTO1" = MSOI8.3,
         "SMTO2" = MSOI8.9,
         "SMTO3" = MSOI8.4,
         "SMTO4" = MSOI8.2,
         "SMTO5" = MSOI8.6,
         "SMTO6" = MSOI8.10,
         "SMTO7" = MSOI8.8,
         "SMTO8" = MSOI8.7,
         "SMTO9" = MSOI8.5,
         "SMTO10" = MSOI8.1,
         "LMTO1" = MSOI8.17,
         "LMTO2" = MSOI8.20,
         "LMTO3" = MSOI8.15,
         "LMTO4" = MSOI8.18,
         "LMTO5" = MSOI8.12,
         "LMTO6" = MSOI8.13,
         "LMTO7" = MSOI8.19) %>%
  mutate_all(~replace(., is.na(.), 0)) %>%
  mutate("LMTO_Score" = `LMTO1` + `LMTO2` + `LMTO3` + `LMTO4` + `LMTO5` +
                        `LMTO6` + `LMTO7`,
         "SMTO_Score" = `SMTO1` + `SMTO2` + `SMTO3` + `SMTO4` + `SMTO5` +
                        `SMTO6` + `SMTO7` + `SMTO8` + `SMTO9` + `SMTO10`,
         "Previous_Sexual_Behavior_Score" = Intercourse_Partners_All +
                                            Intercourse_Partners_All_Past_Year +
                                            Intercourse_Partners_One_Time_Only) 
         
  

```


```{r HSNS}

# clean up and score HSNS data

data_hsns <- surveys_sel_cols %>%
  select(HSNS_1, HSNS_2, HSNS_3, HSNS_4, HSNS_5, HSNS_6, HSNS_7,
         HSNS_8, HSNS_9, HSNS_10) %>%
  # this is an easy way to sum across all rows
  mutate("HSNS Score" = rowSums(.)) 

data_hsns

```



```{r NPI}

# clean up and score NPI data

data_npi <- surveys_sel_cols %>%
  select(NPI_1, NPI_2, NPI_3, NPI_4, NPI_5, NPI_6, NPI_7, NPI_8, NPI_9,
         NPI_10, NPI_11, NPI_12, NPI_13, NPI_14, NPI_15, NPI_16, NPI_17,
         NPI_18, NPI_19, NPI_20, NPI_21, NPI_22, NPI_23, NPI_24, 
         NPI_25, NPI_26, NPI_27, NPI_28, NPI_29, NPI_30, NPI_31, NPI_32,
         NPI_33, NPI_34, NPI_35, NPI_36, NPI_37, NPI_38, NPI_39, NPI_40) %>%
  # this is an easy way to sum across all rows
  mutate("NPI_Score" = rowSums(.)) 

data_npi

surveys_sel_cols
```

```{r SPQ}

# clean up and score SPQ data

data_spq <- surveys_sel_cols %>%
  select(SA2, EB5, MT12, EB14, OS16, CA17, UP22, OS25, CA26, S27, SA29,
         MT30, UP31, CF33, OS34, SA38, CF41, IR45, SA46, MT47, MT55, UP48,
         OS58, S59, IR60, IR63, UP64, S65, CF66, EB67, EB70, CA73) %>%
  # mutate - compute subscales
  mutate("SPQ_Ideas_of_Reference" = IR45 + IR60 + IR63,
         "SPQ_Social_Anxiety" = SA2 + SA29 + SA38 + SA46,
         "SPQ_Odd_Beliefs" = MT12 + MT30 + MT47 + MT55,
         "SPQ_Unusual_Experiences" = UP22 + UP31 + UP48 + UP64,
         "SPQ_Eccentric_Behavior" = EB5 + EB14 + EB67 + EB70,
         "SPQ_No_Close_Friends" = CF33 + CF41 + CF66,
         "SPQ_Odd_Speech" = OS25 + OS34 + OS58,
         "SPQ_Constricted_Affect" = CA17 + CA26 + CA73,
         "SPQ_Paranoid_Ideation" = S27 + S59 + S65,
         "SPQ_Cognitive_Perceptual" = `SPQ_Ideas_of_Reference` +
                                        `SPQ_Odd_Beliefs` +
                                        `SPQ_Paranoid_Ideation` +
                                        `SPQ_Unusual_Experiences`,
         "SPQ_Interpersonal" = `SPQ_Social_Anxiety` +
                                 `SPQ_No_Close_Friends` +
                                 `SPQ_Constricted_Affect` +
                                 `SPQ_Paranoid_Ideation`,
         "SPQ_Disorganized" = `SPQ_Odd_Beliefs` +
                                `SPQ_Odd_Speech`,
         "SPQ_Total" = SA2 + EB5 + MT12 + EB14 + OS16 + CA17 + UP22 + OS25 + 
         CA26 + S27 + SA29 + MT30 + UP31 + CF33 + OS34 + SA38 + CF41 + IR45 + 
         SA46 + MT47 + MT55 + UP48 + OS58 + S59 + IR60 + IR63 + UP64 + S65 + 
         CF66 + EB67 + EB70 + CA73)

data_spq

surveys_sel_cols
``` 



```{r mac ss}

# here we convert the mac ss scale encoded in qualtrics to an actual data number

# this changes offs to 0 and ons to 1-10 (by index). only one of these 10 columns 
# should have an on value. 
surveys_sel_cols$mac_ss_1 = as.numeric(gsub("Off", "0", gsub("On", "1", surveys_sel_cols$mac_ss_1)))
surveys_sel_cols$mac_ss_2 = as.numeric(gsub("Off", "0", gsub("On", "2", surveys_sel_cols$mac_ss_2)))
surveys_sel_cols$mac_ss_3 = as.numeric(gsub("Off", "0", gsub("On", "3", surveys_sel_cols$mac_ss_3)))
surveys_sel_cols$mac_ss_4 = as.numeric(gsub("Off", "0", gsub("On", "4", surveys_sel_cols$mac_ss_4)))
surveys_sel_cols$mac_ss_5 = as.numeric(gsub("Off", "0", gsub("On", "5", surveys_sel_cols$mac_ss_5)))
surveys_sel_cols$mac_ss_6 = as.numeric(gsub("Off", "0", gsub("On", "6", surveys_sel_cols$mac_ss_6)))
surveys_sel_cols$mac_ss_7 = as.numeric(gsub("Off", "0", gsub("On", "7", surveys_sel_cols$mac_ss_7)))
surveys_sel_cols$mac_ss_8 = as.numeric(gsub("Off", "0", gsub("On", "8", surveys_sel_cols$mac_ss_8)))
surveys_sel_cols$mac_ss_9 = as.numeric(gsub("Off", "0", gsub("On", "9", surveys_sel_cols$mac_ss_9)))
surveys_sel_cols$mac_ss_10 = as.numeric(gsub("Off", "0", gsub("On", "10", surveys_sel_cols$mac_ss_10)))

# we then add them all together, so that only one column is needed to
# denote mac_ss
surveys_sel_cols <- surveys_sel_cols %>%
  mutate(mac_ss_1 = mac_ss_1 + mac_ss_2 + mac_ss_3 + mac_ss_4 + mac_ss_5 + mac_ss_6 +
                  mac_ss_7 + mac_ss_8 + mac_ss_9 + mac_ss_10) %>%
  select(-mac_ss_2, -mac_ss_3, -mac_ss_4, -mac_ss_5, -mac_ss_6,
                  -mac_ss_7, -mac_ss_8, -mac_ss_9, -mac_ss_10) %>%
  rename(mac_ss = mac_ss_1)


data_mac_ss <- select(surveys_sel_cols, mac_ss)

surveys_sel_cols
```
```{r APQ}

data_apq <- select(surveys_sel_cols, APQ_1, APQ_2, APQ_3, APQ_4,
                   APQ_5, APQ_6, APQ_7, APQ_8, APQ_9, APQ_9_1_TEXT, 
                   APQ_9_2_TEXT, APQ_9_3_TEXT, APQ_10, APQ_11,
                   APQ_12, APQ_13, APQ_14, APQ_15, APQ_16, APQ_17,
                   APQ_18) %>%
  mutate(APQ_Grade_Trajectory = APQ_1, GPA = APQ_2, English_Grade = APQ_3,
         Math_Grade = APQ_4, Science_Grade = APQ_5, 
         SocialStudies_Grade = APQ_6, Grade_Intelligence_Comparison = APQ_7,
         Tutoring = APQ_8, Standardized_Test = APQ_9, 
         SAT_Score = APQ_9_1_TEXT, ACT_Score = APQ_9_2_TEXT,
         Other_Test_Score = APQ_9_3_TEXT,
         Academic_Ambition = APQ_10, Performance_Identity = APQ_11,
         Grade_Anxiety = APQ_12, Colleague_Rapport = APQ_13, 
         Unviersity_Belonging = APQ_14, Colleague_Prejudice = APQ_15,
         University_Happiness = APQ_16, Professor_Fairness = APQ_17,
         University_Safety = APQ_18)

data_apq


```

```{r PPI}

# woo hoo, found a new function that makes the job a bit easier
# "Contains" in select selects all the columns with that string in 
# the name

data_ppi <- select(surveys_sel_cols, contains("PPI")) %>%
  mutate("PPI_SCORE" = rowSums(.),
         # this way we can sum all of the questions of a subscale in
         # one pass, by selecting the columns with the identifying string
         "PPI_MACH_SCORE" = rowSums(select(., contains("MACH"))),
         "PPI_FEAR_SCORE" = rowSums(select(., contains("FEAR"))),
         "PPI_REBEL_SCORE" = rowSums(select(., contains("REBEL"))),
         "PPI_BLAME_SCORE" = rowSums(select(., contains("BLAME"))),
         "PPI_STRESS_SCORE" = rowSums(select(., contains("STRESS"))),
         "PPI_COLD_SCORE" = rowSums(select(., contains("COLD"))),
         "PPI_SOCIAL_SCORE" = rowSums(select(., contains("SOCIAL"))),
         "PPI_CAREFREE_SCORE" = rowSums(select(., contains("CARE"))))
  
data_ppi

```

```{r HEXACO}

data_hexaco <- select(surveys_sel_cols, contains("OPEN"), 
                                           contains("CONSC"), 
                                           contains("AGREE"),
                                           contains("EXTRA"), 
                                           contains("EMOTION"),
                                           contains("HONHUM")) %>%
  mutate(OPEN_SCORE = rowSums(select(., contains("OPEN"))),
         CONSC_SCORE = rowSums(select(., contains("CONSC"))),
         AGREE_SCORE = rowSums(select(., contains("AGREE"))),
         EXTRA_SCORE = rowSums(select(., contains("EXTRA"))),
         EMOTION_SCORE = rowSums(select(., contains("EMOTION"))),
         HONHUM_SCORE = rowSums(select(., contains("HONHUM"))))

data_hexaco


```

```{r couples dominiance}

# this one is on a scale from 1 (I am dominant) to 5 (the other person is dominant)

data_couples_dom <- select(surveys_sel_cols, Couples_dom)

```

```{r power scale}

# 1 (Strongly Disagree) to 6 (Strongly Agree)

data_power_scale <- select(surveys_sel_cols, contains("FP"),
                                                contains("DP"),
                           AP1, AP2, AP3, AP4, AP5, AP6, AP7) %>%
  mutate(FP_SCORE = rowSums(select(., contains("FP"))),
         DP_SCORE = rowSums(select(., contains("DP"))),
         AP_SCORE = rowSums(select(., contains("AP"))))

data_power_scale

```

```{r STAI}

# scores range from 20 to 80, higher is higher anxiety

data_stai <- select(surveys_sel_cols, contains("STAI")) %>%
  mutate(STAI_SCORE = rowSums(select(., contains("STAI"))))

data_stai

```

```{r AQ}

# higher is more autistic 

data_aq <- select(surveys_sel_cols, contains("AQ_")) %>%
  mutate(AQ_SCORE = rowSums(select(., contains("AQ_"))))

data_aq

```

```{r PAI}

# have to subtract 24 here (6 in each category), one point for each 
# question, since the answers are off by one in their scoring

data_pai <- select(surveys_sel_cols, contains("PAI_")) %>%
  mutate(PAI_Affective_Instability = PAI_19400 + PAI_19403 + PAI_19406 +
                                     PAI_19409 + PAI_19413 + PAI_19417 - 6,
         PAI_Identity_Problems = PAI_19401 + PAI_19404 + PAI_19407 +
                                 PAI_19410 + PAI_19414 + PAI_19418 - 6,
         PAI_Negative_Relationships = PAI_19402 + PAI_19405 + PAI_19408 +
                                      PAI_19411 + PAI_19415 + PAI_19419 - 6,
         PAI_Self_Harm = PAI_19412 + PAI_19416 + PAI_19420 + PAI_19421 +
                         PAI_19422 + PAI_19423 - 6,
         PAI_SCORE = PAI_Identity_Problems + PAI_Negative_Relationships +
                     PAI_Self_Harm + PAI_Affective_Instability)

data_pai

```

```{r suicide}

# see readme for detailed breakdown

data_suicide <- select(surveys_sel_cols, contains("SBQ"),
                                            current_suicide) %>%
  mutate(suicide_thoughts_attempts = SBQ1, suicidal_thoughts_freq = SBQ2,
         suicide_confide = SBQ3, suicide_likelihood = SBQ4,
         current_suicidality = current_suicide)

```

```{r demographics}

# see readme for detailed breakdown

data_demography <- select(surveys_sel_cols, birth, sex, ethnicity,
                          state_born, marriage, occupation, major, 
                          raised_by, smoke, alcohol, hormone_drugs,
                          hormone_drugs_1_TEXT, hormone_drugs_2_TEXT,
                          end) %>%
  rename(age = birth)

```
